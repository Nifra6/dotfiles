#!/usr/bin/env bash
# Toggle between light and dark themes for Kitty and Neovim.
set -euo pipefail

KITTY_CONF="$HOME/.config/kitty/current-theme.conf"
LIGHT_KITTY="$HOME/.config/kitty/themes/tokyonight_day.conf"
DARK_KITTY="$HOME/.config/kitty/themes/tokyonight_moon.conf"

NEOVIM_CONF="$HOME/.config/nvim/lua/nifra/theme.lua"
LIGHT_NVIM="tokyonight-day"
DARK_NVIM="tokyonight-moon"

if [[ ! -f $KITTY_CONF || ! -f $NEOVIM_CONF ]]; then
    echo "Error: missing config file." >&2
    exit 1
fi

# Toggle theme
if grep -Fq "$DARK_NVIM" "$NEOVIM_CONF"; then
    cp $LIGHT_KITTY $KITTY_CONF
    sed -i "s|$DARK_NVIM|$LIGHT_NVIM|" "$NEOVIM_CONF"
    THEME="Light theme â˜€ï¸"
else
    cp $DARK_KITTY $KITTY_CONF
    sed -i "s|$LIGHT_NVIM|$DARK_NVIM|" "$NEOVIM_CONF"
    THEME="Dark theme ðŸŒ™"
fi
echo "Theme updated in files â†’ $THEME"

# --- Reload Kitty safely ---
if command -v kitty >/dev/null 2>&1 && kitty @ ls >/dev/null 2>&1; then
    kitty @ set-colors -a "$KITTY_CONF"
    echo "Kitty config reloaded via socket âœ…"
else
    echo "âš ï¸ Kitty socket not available â€” try restarting Kitty manually."
    echo "Tip: from a Kitty terminal, run â†’ kitty @ set-colors -a $KITTY_CONF"
fi

# --- Optional desktop notification ---
if command -v notify-send >/dev/null 2>&1; then
    notify-send "Theme switched" "$THEME" -i preferences-desktop-theme
fi
